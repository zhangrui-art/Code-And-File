<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style type="text/css">

    </style>
    <script>
        function axios({
            url,
            method="GET",
            params={},
            data={}
        }) {
            // 返回一个promise对象
            return new Promise((resolve, reject)=>{

                // 处理query参数（拼接到url上）  id=1&xxx=abc
                let queryString = ''
                let queryArr = [] 
                Object.keys(params).forEach(key => {
                    queryArr.push(`${key}=${params[key]}`)
                })
                queryString = queryArr.join("&")
                url += '?' + queryString
                // 执行异步ajax请求
                // 创建xhr对象
                const xhrRequest = new XMLHttpRequest()
                // 打开连接（初始化请求，没有请求）
                xhrRequest.open(method,url,true)
                // 发送请求
                if(method === "GET") {
                    xhrRequest.send()
                }else if(method === "POST"){
                    // 如果发送json格式的请求体参数， 必须加请求头
                    xhrRequest.setRequestHeader('Content-Type','application/json;charset=utf-8')
                    xhrRequest.send(JSON.stringify(data))    // 发送json格式的请求体参数 
                }
                
                // 绑定状态改变的监听
                xhrRequest.onreadystatechange = function (params) {
                    // 如果请求没有完成，直接结束
                    if(xhrRequest.readyState !== 4) return
                }
                // 如果响应状态码在 [200, 300) 代表成功，否则失败
                const {status, statusText} = xhrRequest
                // 如果请求成功了，resolve
                if(status>=200 && status<=299){
                    resolve()
                } else {  // 如果请求失败了，reject
                    reject()
                }
            })
        }      
        function testGet() {
            axios({
                url: 'http://localhost:3000/posts',
                method: 'GET',
                params: {
                    id: 1,
                    xxx: "abc"
                }
            })
        }       
        function testPost() {
            axios({
                url: 'http://localhost:3000/posts',
                method: 'POST',
                data: {
                    "title": "json-server--",
                    "author": "typicode3"
                }
            })
        }         
    </script>
</head>

<body>
    <div>
        <button onclick="testGet()">GET请求</button>
        <button onclick="testPost()">POST请求</button>
        <button onclick="testPut()">PUT请求</button>
        <button onclick="testDelete()">DELETE请求</button>
    </div>
</body>

</html>